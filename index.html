<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Macronizer for Ancient Greek</title>
    <style>
        @font-face {
            font-family: 'GFSPorson';
            src: url('fonts/GFSPorson.otf') format('opentype');
            font-weight: normal;
            font-style: normal;
        }

        h1 {
            font-family: 'GFSPorson', serif;
        }

        @font-face {
            font-family: 'New Athena Unicode';
            src: url('fonts/new-athena-unicode.ttf') format('truetype');
            font-weight: normal;
            font-style: normal;
        }

        body {
            font-family: sans-serif; /* Use default font */
            margin: 0;
            padding: 20px;
            background-color: #f5eed7; /* Site background */
            color: black;
            max-width: 100%;
            box-sizing: border-box;
        }

        #searchBox {
            font-family: 'New Athena Unicode', sans-serif;
            width: 100%;
            padding: 8px;
            box-sizing: border-box;
            font-size: 1em; /* Default font size */
            background-color: #d2b48c; /* Background color */
            border: none; /* Remove border */
            border-radius: 5px; /* Add some rounding to match the box style */
            outline: none; /* Remove ugly blue highlighting */
        }

        .search-input {
            font-family: 'New Athena Unicode', sans-serif;
            font-size: 1.2em; /* Adjust the size as needed */
            /* You can also add other styling like color, weight, etc. */
        }

        /* Style for the tan info box */
        .info-box {
            background-color: #d2b48c; /* Tan background color */
            padding: 15px;
            margin-top: 20px;
            border-radius: 5px;
            font-size: 14px;
            line-height: 1.5;
        }

        .info-box a {
            color: #0066cc;
            text-decoration: none;
        }

        .info-box a:hover {
            text-decoration: underline;
        }

        /* Styles for the search suggestions */
        .suggestions {
            border: 1px solid #ccc;
            border-top: none;
            max-height: 150px;
            overflow-y: auto;
            background-color: white;
            position: absolute;
            width: calc(100% - 16px); /* Adjust for padding */
            z-index: 1000;
            box-sizing: border-box;
        }

        .suggestion-item {
            padding: 8px;
            cursor: pointer;
        }

        .suggestion-item:hover, .highlighted {
            background-color: #f0f0f0;
        }

        /* Dark mode styles */
        @media (prefers-color-scheme: dark) {
            body {
                background-color: #121212;
                color: #e0e0e0;
            }

            .info-box {
                background-color: #333333; /* Darker tan-like color for dark mode */
                color: #e0e0e0;
            }

            .info-box a {
                color: #80b3ff;
            }

            .info-box a:hover {
                text-decoration: underline;
            }

            #searchBox {
                background-color: #333333;
                color: #e0e0e0;
                border: none; /* Remove border */
            }

            .search-input {
                font-size: 1.2em;
                background-color: #333333;
                color: #e0e0e0;
                border: 1px solid #444444;
            }

            button {
                background-color: #444444;
                color: #e0e0e0;
                border: 1px solid #555555;
            }

            button:hover {
                background-color: #555555;
            }

            .suggestions {
                background-color: #333333;
                color: #e0e0e0;
                border: 1px solid #444444;
            }

            .suggestion-item:hover, .highlighted {
                background-color: #555555;
            }
        }

        /* Responsive styles for smaller screens */
        @media (max-width: 767px) {
            body {
                padding: 10px;
            }

            #searchBox {
                font-size: 16px;
                padding: 12px;
            }

            .info-box {
                font-size: 14px;
                padding: 10px;
            }

            .search-input {
                font-size: 1em;
            }
        }

        /* Responsive styles for larger screens */
        @media (min-width: 768px) {
            #searchBox {
                font-size: 18px; /* Larger font size for bigger screens */
                padding: 12px;
            }

            .info-box {
                font-size: 16px; /* Larger font size for bigger screens */
                padding: 15px;
            }

            .search-input {
                font-size: 1.3em;
            }
        }
    </style>
</head>
<body>
    <h1 id="title"></h1> <!-- The title element -->
    <div style="position: relative;">
        <input type="text" id="searchBox" placeholder="Start typing Ancient Greek word">
        <div id="suggestions" class="suggestions"></div>
    </div>
    <p id="result"></p>

    <div class="info-box">
        <p>The macronizer is limited to tragic vocabulary, i.e. to around 41,000 word forms appearing in the extant works of Aeschylus, Sophocles, and Euripides. Begun as a master project by Albin Thörn Cleland, it is primarily based on a collation of the vowel length data of LSJ and Wiktionary. Around three thousand entries have been disambiguated because they contain dichrona in open syllables included in the scanned corpus on David Chamberlain's marvellous <a href="https://hypotactic.com" target="_blank">hypotactic.com</a>. Many endings have been macronized algorithmically based on conjugation and declension tables. Each result has a source indication.</p>
        <p>To contact me or suggest features, see the GitHub repositories for the <a href="https://github.com/Urdatorn/greek-macronizer-site" target="_blank">site</a> and the <a href="https://github.com/Urdatorn/greek-macronizer" target="_blank">backend</a>.</p>
        <p>To learn more about the history of dichrona vowels and how exactly I went about collecting the data, see my <a href="macronizer_thesis_prel.pdf" target="_blank">master thesis</a>.</p>
        <p>If you have use of this site, consider clicking the button below. Remember, εἰς τὰ τοιαῦτα δεῖ ἐκτενῶς ἀναλίσκειν! (Marc. Aur. 1, 4)</p>
        
        <!-- Buy Me Ataraxia Button -->
        <script type="text/javascript" src="https://cdnjs.buymeacoffee.com/1.0.0/button.prod.min.js" data-name="bmc-button" data-slug="phrontisterion" data-color="#FFDD00" data-emoji=""  data-font="Cookie" data-text="Buy me ataraxia" data-outline-color="#000000" data-font-color="#000000" data-coffee-color="#ffffff" ></script>
    </div>

    <script>
        let currentIndex = -1; // Index for the currently highlighted suggestion

        // Greek alphabet regex
        const baseAlphabet = /[ΑΒΓΔΕΖΗΘΙΚΛΜΝΞΟΠΡΣΤΥΦΧΨΩαβγδεζηθικλμνξοπρσςτυφχψω]/;

        // Function to get the base character after normalization
        function base(ch) {
            return ch.normalize('NFD')[0];
        }

        // Function to apply diacritical marks based on instructions
        function applyDiacritics(input, instructions) {
            const combiningMacron = '\u0304'; // Combining Macron
            const combiningBreve = '\u0306'; // Combining Breve

            // Split the instructions into pairs
            const instructionsArray = instructions.match(/[_^]\d+/g);
            if (!instructionsArray) return input; // No instructions

            // Filter Greek alphabet characters from the input
            let filteredInput = Array.from(input).filter(char => baseAlphabet.test(base(char)));

            // Apply diacritical marks based on the instructions
            for (const instruction of instructionsArray) {
                const type = instruction[0]; // '_' or '^'
                const index = parseInt(instruction.slice(1), 10) - 1; // Convert to 0-based index

                if (index >= 0 && index < filteredInput.length) {
                    if (type === '_') {
                        // Combine with Macron
                        filteredInput[index] += combiningMacron;
                    } else if (type === '^') {
                        // Combine with Breve
                        filteredInput[index] += combiningBreve;
                    }
                }
            }

            return filteredInput.join('');
        }

        // Function to show suggestions as user types
        document.getElementById('searchBox').addEventListener('input', async function () {
            const searchValue = this.value.trim().toLowerCase();
            const suggestionsBox = document.getElementById('suggestions');
            suggestionsBox.innerHTML = ''; // Clear previous suggestions
            currentIndex = -1; // Reset current index

            if (searchValue.length > 0) {
                const response = await fetch('macrons_alg4_barytone.tsv');
                const tsvData = await response.text();
                const lines = tsvData.split('\n').slice(1); // Skip the header

                const matches = lines.filter(line => {
                    const columns = line.split('\t');
                    const name = columns[0].trim().toLowerCase();
                    return name.startsWith(searchValue);
                }).slice(0, 10); // Limit to top 10 matches

                matches.forEach(match => {
                    const columns = match.split('\t');
                    const name = columns[0].trim();
                    const resultCol = columns[3];
                    const sourceCol = columns[4].trim();

                    const suggestionItem = document.createElement('div');
                    suggestionItem.classList.add('suggestion-item');
                    suggestionItem.innerHTML = `<strong>${name}</strong>: ${resultCol}<br>(Source: ${sourceCol})`;

                    // On click, set the input value and hide suggestions
                    suggestionItem.addEventListener('click', function () {
                        document.getElementById('searchBox').value = name;
                        suggestionsBox.innerHTML = '';
                        searchTSV();
                    });

                    suggestionsBox.appendChild(suggestionItem);
                });
            }
        });

        // Event listener to handle keyboard navigation in suggestions
        document.getElementById('searchBox').addEventListener('keydown', function (e) {
            const suggestionsBox = document.getElementById('suggestions');
            const items = suggestionsBox.getElementsByClassName('suggestion-item');

            if (e.key === 'ArrowDown') {
                e.preventDefault();
                if (currentIndex < items.length - 1) {
                    currentIndex++;
                    updateHighlight(items);
                }
            } else if (e.key === 'ArrowUp') {
                e.preventDefault();
                if (currentIndex > 0) {
                    currentIndex--;
                    updateHighlight(items);
                }
            } else if (e.key === 'Enter') {
                if (currentIndex > -1) {
                    e.preventDefault();
                    items[currentIndex].click();
                } else {
                    e.preventDefault(); // Prevent the default form submission
                    suggestionsBox.innerHTML = ''; // Clear the suggestions
                    searchTSV(); // Perform the search
                }
            }
        });

        // Function to update the highlighted suggestion
        function updateHighlight(items) {
            for (let i = 0; i < items.length; i++) {
                items[i].classList.remove('highlighted');
            }
            if (currentIndex > -1 && items[currentIndex]) {
                items[currentIndex].classList.add('highlighted');
            }
        }

        async function searchTSV() {
            const searchValue = document.getElementById('searchBox').value.trim();
            const response = await fetch('macrons_alg4_barytone.tsv');
            const tsvData = await response.text();

            const lines = tsvData.split('\n').slice(1); // Skip the header
            let result = "Not found";

            for (const line of lines) {
                const columns = line.split('\t');
                const name = columns[0].trim().toLowerCase();
                const resultCol = columns[3];
                let sourceCol = columns[4].trim();

                if (name === searchValue.trim().toLowerCase()) {
                    if (sourceCol.toLowerCase() === 'breve_ultima') {
                        sourceCol = 'Morphological tables for breve on the ultima';
                    }
                    // Apply diacritics based on the fourth column data
                    const modifiedInput = applyDiacritics(searchValue, resultCol);
                    result = `<span class="search-input">${modifiedInput}</span><br>${resultCol}<br>(Source: ${sourceCol})`;
                    break;
                }
            }

            document.getElementById('result').innerHTML = result;
            document.getElementById('suggestions').innerHTML = ''; // Clear suggestions after the search
        }
    </script>
    <script>
        // Array of title options
        const titles = [
            "συστέλλω τὰ δίχρονα!",
            "ἐκτείνω τὰ δίχρονα!",
            "ἢ ἐκτεταμένον ἢ συνεσταλμένον ἔχω τὰ δίχρονα!",
            "ἐκτετα-συνεσταλμένον αὐτόματον",
            "ἀντιαδιαφοροδιχρονιστὲς αὐτόματον"
        ];

        // Function to select a random title
        function getRandomTitle() {
            const randomIndex = Math.floor(Math.random() * titles.length);
            return titles[randomIndex];
        }

        // Set the random title as the content of the h1 element
        document.getElementById('title').innerText = getRandomTitle();
    </script>
</body>
</html>
